<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriWeb Admin - Greenhouse Control Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script type="module">
        import { toggleWaterSystem, toggleClimateControl, toggleFarmingSystems, togglePowerGrid, enableAllSystems, emergencyShutdown, systemReset } from '/challenge/js/admin.js';
        window.toggleWaterSystem = toggleWaterSystem;
        window.toggleClimateControl = toggleClimateControl;
        window.toggleFarmingSystems = toggleFarmingSystems;
        window.togglePowerGrid = togglePowerGrid;
        window.enableAllSystems = enableAllSystems;
        window.emergencyShutdown = emergencyShutdown;
        window.systemReset = systemReset;
    </script>
    <script type="module" src="/challenge/js/main.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Press Start 2P', cursive;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 25%, #334155 50%, #475569 75%, #64748b 100%);
            color: #f1f5f9;
            min-height: 100vh;
        }
        
        .admin-card {
            background: linear-gradient(145deg, rgba(15, 23, 42, 0.95), rgba(30, 41, 59, 0.9));
            border: 2px solid #dc2626;
            box-shadow: 0 0 30px rgba(220, 38, 38, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .system-card {
            background: linear-gradient(145deg, rgba(15, 23, 42, 0.9), rgba(30, 41, 59, 0.8));
            border: 1px solid #10b981;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .system-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 25px rgba(16, 185, 129, 0.3);
        }
        
        .status-online {
            color: #10b981;
            text-shadow: 0 0 10px #10b981;
        }
        
        .status-offline {
            color: #ef4444;
            text-shadow: 0 0 10px #ef4444;
        }
        
        .status-warning {
            color: #f59e0b;
            text-shadow: 0 0 10px #f59e0b;
        }
        
        .btn-admin {
            background: linear-gradient(45deg, #dc2626, #b91c1c);
            color: #fff;
            transition: all 0.3s ease;
        }
        
        .btn-admin:hover {
            background: linear-gradient(45deg, #b91c1c, #991b1b);
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #10b981, #059669);
            color: #fff;
            transition: all 0.3s ease;
        }
        
        .btn-success:hover {
            background: linear-gradient(45deg, #059669, #047857);
            transform: translateY(-2px);
        }
        
        .btn-warning {
            background: linear-gradient(45deg, #f59e0b, #d97706);
            color: #fff;
            transition: all 0.3s ease;
        }
        
        .btn-warning:hover {
            background: linear-gradient(45deg, #d97706, #b45309);
            transform: translateY(-2px);
        }
        
        .control-panel {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #dc2626;
        }
        
        .metric-bar {
            background: rgba(30, 41, 59, 0.8);
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .metric-fill {
            height: 100%;
            transition: width 0.5s ease;
        }
        
        .metric-online { background: linear-gradient(90deg, #10b981, #059669); }
        .metric-offline { background: linear-gradient(90deg, #ef4444, #dc2626); }
        .metric-warning { background: linear-gradient(90deg, #f59e0b, #d97706); }
        
        .glow-red {
            text-shadow: 0 0 20px #dc2626;
        }
        
        .pulse-red {
            animation: pulse-red 2s infinite;
        }
        
        @keyframes pulse-red {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
    </style>
</head>
<body>
    <div class="container mx-auto px-4 py-6">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl md:text-5xl mb-4 glow-red">
                <span class="text-red-400">AGRI</span><span class="text-slate-100">WEB</span>
                <span class="text-red-400">ADMIN</span>
            </h1>
            <div class="admin-card p-6 rounded-xl mb-6 max-w-3xl mx-auto">
                <div class="flex items-center justify-center mb-3">
                    <i data-lucide="shield-alert" class="w-8 h-8 mr-3 text-red-400 pulse-red"></i>
                    <span class="text-sm md:text-base">Greenhouse Control Center - Administrative Access</span>
                </div>
                <p class="text-xs mt-3 text-red-400">
                    ðŸ”’ RESTRICTED ACCESS: Administrative controls for all agricultural systems
                </p>
                <p class="text-xs mt-3 text-red-400">
                    HTB{fake_flag_for_testing}
                </p>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="adminDashboard">
            <!-- System Control Grid -->
            <div class="grid lg:grid-cols-4 gap-6 mb-8">
                <div class="system-card p-6 rounded-xl text-center">
                    <i data-lucide="droplets" class="w-12 h-12 mx-auto mb-4 text-blue-400"></i>
                    <h3 class="text-sm mb-3">WATER SYSTEMS</h3>
                    <div class="space-y-3">
                        <div class="text-xs">
                            <div class="flex justify-between mb-1">
                                <span>Status:</span>
                                <span id="waterStatus" class="status-offline">OFFLINE</span>
                            </div>
                            <div class="metric-bar">
                                <div id="waterBar" class="metric-fill metric-offline" style="width: 0%"></div>
                            </div>
                        </div>
                        <button onclick="window.toggleWaterSystem()" id="waterBtn" class="btn-success w-full py-2 text-xs rounded">
                            ENABLE WATER
                        </button>
                    </div>
                </div>
                
                <div class="system-card p-6 rounded-xl text-center">
                    <i data-lucide="thermometer" class="w-12 h-12 mx-auto mb-4 text-orange-400"></i>
                    <h3 class="text-sm mb-3">CLIMATE CONTROL</h3>
                    <div class="space-y-3">
                        <div class="text-xs">
                            <div class="flex justify-between mb-1">
                                <span>Status:</span>
                                <span id="climateStatus" class="status-offline">OFFLINE</span>
                            </div>
                            <div class="metric-bar">
                                <div id="climateBar" class="metric-fill metric-offline" style="width: 0%"></div>
                            </div>
                        </div>
                        <button onclick="window.toggleClimateControl()" id="climateBtn" class="btn-success w-full py-2 text-xs rounded">
                            ENABLE CLIMATE
                        </button>
                    </div>
                </div>
                
                <div class="system-card p-6 rounded-xl text-center">
                    <i data-lucide="sprout" class="w-12 h-12 mx-auto mb-4 text-green-400"></i>
                    <h3 class="text-sm mb-3">FARMING SYSTEMS</h3>
                    <div class="space-y-3">
                        <div class="text-xs">
                            <div class="flex justify-between mb-1">
                                <span>Status:</span>
                                <span id="farmingStatus" class="status-offline">OFFLINE</span>
                            </div>
                            <div class="metric-bar">
                                <div id="farmingBar" class="metric-fill metric-offline" style="width: 0%"></div>
                            </div>
                        </div>
                        <button onclick="window.toggleFarmingSystems()" id="farmingBtn" class="btn-success w-full py-2 text-xs rounded">
                            ENABLE FARMING
                        </button>
                    </div>
                </div>
                
                <div class="system-card p-6 rounded-xl text-center">
                    <i data-lucide="zap" class="w-12 h-12 mx-auto mb-4 text-yellow-400"></i>
                    <h3 class="text-sm mb-3">POWER GRID</h3>
                    <div class="space-y-3">
                        <div class="text-xs">
                            <div class="flex justify-between mb-1">
                                <span>Status:</span>
                                <span id="powerStatus" class="status-offline">OFFLINE</span>
                            </div>
                            <div class="metric-bar">
                                <div id="powerBar" class="metric-fill metric-offline" style="width: 0%"></div>
                            </div>
                        </div>
                        <button onclick="window.togglePowerGrid()" id="powerBtn" class="btn-success w-full py-2 text-xs rounded">
                            ENABLE POWER
                        </button>
                    </div>
                </div>
            </div>

            <!-- Master Control Panel -->
            <div class="grid lg:grid-cols-2 gap-6 mb-8">
                <div class="admin-card p-6 rounded-xl">
                    <div class="flex items-center mb-6">
                        <i data-lucide="settings" class="w-6 h-6 mr-3 text-red-400"></i>
                        <span class="text-sm">MASTER CONTROL PANEL</span>
                    </div>
                    
                    <div class="space-y-4">
                        <button onclick="window.enableAllSystems()" class="btn-success w-full py-4 text-sm rounded-lg">
                            <i data-lucide="power" class="w-5 h-5 mr-2 inline"></i>
                            ENABLE ALL SYSTEMS
                        </button>
                        
                        <button onclick="window.emergencyShutdown()" class="btn-admin w-full py-4 text-sm rounded-lg">
                            <i data-lucide="power-off" class="w-5 h-5 mr-2 inline"></i>
                            EMERGENCY SHUTDOWN
                        </button>
                        
                        <button onclick="window.systemReset()" class="btn-warning w-full py-4 text-sm rounded-lg">
                            <i data-lucide="refresh-cw" class="w-5 h-5 mr-2 inline"></i>
                            SYSTEM RESET
                        </button>
                    </div>
                </div>
                
                <div class="system-card p-6 rounded-xl">
                    <div class="flex items-center mb-6">
                        <i data-lucide="activity" class="w-6 h-6 mr-3 text-emerald-400"></i>
                        <span class="text-sm">SYSTEM METRICS</span>
                    </div>
                    
                    <div class="space-y-4 text-xs">
                        <div>
                            <div class="flex justify-between mb-2">
                                <span>Overall System Health:</span>
                                <span id="overallHealth" class="status-offline">0%</span>
                            </div>
                            <div class="metric-bar">
                                <div id="overallBar" class="metric-fill metric-offline" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <div>
                            <div class="flex justify-between mb-2">
                                <span>Active Greenhouses:</span>
                                <span id="activeGreenhouses" class="text-slate-300">0/24</span>
                            </div>
                        </div>
                        
                        <div>
                            <div class="flex justify-between mb-2">
                                <span>Crop Survival Rate:</span>
                                <span id="cropSurvival" class="status-offline">8%</span>
                            </div>
                        </div>
                        
                        <div>
                            <div class="flex justify-between mb-2">
                                <span>Environmental Stability:</span>
                                <span id="envStability" class="status-offline">CRITICAL</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Activity Log -->
            <div class="admin-card p-6 rounded-xl">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <i data-lucide="terminal" class="w-6 h-6 mr-3 text-red-400"></i>
                        <span class="text-sm">ADMINISTRATIVE LOG</span>
                    </div>
                    <button onclick="clearAdminLog()" class="btn-admin px-4 py-2 rounded-lg text-xs">
                        CLEAR LOG
                    </button>
                </div>
                
                <div id="adminLog" class="control-panel text-xs p-4 rounded-lg min-h-[200px] max-h-[300px] overflow-auto">
                    <div class="text-red-400 mb-2">[ADMIN] Administrative access granted</div>
                    <div class="text-yellow-400 mb-2">[SYSTEM] All greenhouse systems offline</div>
                    <div class="text-red-400 mb-2">[CRITICAL] Agricultural infrastructure failure detected</div>
                    <div class="text-slate-500">$ Awaiting administrative commands...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        let systemStates = {
            water: false,
            climate: false,
            farming: false,
            power: false
        };


        // System control functions
        function toggleWaterSystem() {
            systemStates.water = !systemStates.water;
            updateSystemDisplay('water', systemStates.water);
            logAdmin(`[WATER] Water systems ${systemStates.water ? 'ENABLED' : 'DISABLED'}`, systemStates.water ? 'success' : 'warning');
            updateOverallHealth();
        }

        function toggleClimateControl() {
            systemStates.climate = !systemStates.climate;
            updateSystemDisplay('climate', systemStates.climate);
            logAdmin(`[CLIMATE] Climate control ${systemStates.climate ? 'ENABLED' : 'DISABLED'}`, systemStates.climate ? 'success' : 'warning');
            updateOverallHealth();
        }

        function toggleFarmingSystems() {
            systemStates.farming = !systemStates.farming;
            updateSystemDisplay('farming', systemStates.farming);
            logAdmin(`[FARMING] Farming systems ${systemStates.farming ? 'ENABLED' : 'DISABLED'}`, systemStates.farming ? 'success' : 'warning');
            updateOverallHealth();
        }

        function togglePowerGrid() {
            systemStates.power = !systemStates.power;
            updateSystemDisplay('power', systemStates.power);
            logAdmin(`[POWER] Power grid ${systemStates.power ? 'ENABLED' : 'DISABLED'}`, systemStates.power ? 'success' : 'warning');
            updateOverallHealth();
        }

        function enableAllSystems() {
            logAdmin('[MASTER] Initiating full system activation...', 'info');
            
            Object.keys(systemStates).forEach(system => {
                systemStates[system] = true;
                updateSystemDisplay(system, true);
            });
            
            updateOverallHealth();
            logAdmin('[SUCCESS] All agricultural systems online!', 'success');
            logAdmin('[RESTORATION] Greenhouse operations restored to full capacity', 'success');
        }

        function emergencyShutdown() {
            logAdmin('[EMERGENCY] Initiating emergency shutdown protocol...', 'warning');
            
            Object.keys(systemStates).forEach(system => {
                systemStates[system] = false;
                updateSystemDisplay(system, false);
            });
            
            updateOverallHealth();
            logAdmin('[SHUTDOWN] All systems safely offline', 'error');
        }

        function systemReset() {
            logAdmin('[RESET] Performing system reset...', 'info');
            emergencyShutdown();
            setTimeout(() => {
                logAdmin('[RESET] System reset complete - ready for reactivation', 'info');
            }, 2000);
        }

        function updateSystemDisplay(system, isOnline) {
            const statusElement = document.getElementById(`${system}Status`);
            const barElement = document.getElementById(`${system}Bar`);
            const btnElement = document.getElementById(`${system}Btn`);
            
            if (isOnline) {
                statusElement.textContent = 'ONLINE';
                statusElement.className = 'status-online';
                barElement.style.width = '100%';
                barElement.className = 'metric-fill metric-online';
                btnElement.textContent = `DISABLE ${system.toUpperCase()}`;
                btnElement.className = 'btn-admin w-full py-2 text-xs rounded';
            } else {
                statusElement.textContent = 'OFFLINE';
                statusElement.className = 'status-offline';
                barElement.style.width = '0%';
                barElement.className = 'metric-fill metric-offline';
                btnElement.textContent = `ENABLE ${system.toUpperCase()}`;
                btnElement.className = 'btn-success w-full py-2 text-xs rounded';
            }
        }

        function updateOverallHealth() {
            const onlineSystems = Object.values(systemStates).filter(state => state).length;
            const totalSystems = Object.keys(systemStates).length;
            const healthPercentage = Math.round((onlineSystems / totalSystems) * 100);
            
            document.getElementById('overallHealth').textContent = `${healthPercentage}%`;
            document.getElementById('overallBar').style.width = `${healthPercentage}%`;
            document.getElementById('activeGreenhouses').textContent = `${onlineSystems * 6}/24`;
            
            if (healthPercentage === 100) {
                document.getElementById('overallHealth').className = 'status-online';
                document.getElementById('overallBar').className = 'metric-fill metric-online';
                document.getElementById('cropSurvival').textContent = '95%';
                document.getElementById('cropSurvival').className = 'status-online';
                document.getElementById('envStability').textContent = 'OPTIMAL';
                document.getElementById('envStability').className = 'status-online';
            } else if (healthPercentage > 50) {
                document.getElementById('overallHealth').className = 'status-warning';
                document.getElementById('overallBar').className = 'metric-fill metric-warning';
                document.getElementById('cropSurvival').textContent = `${Math.round(healthPercentage * 0.8)}%`;
                document.getElementById('cropSurvival').className = 'status-warning';
                document.getElementById('envStability').textContent = 'STABILIZING';
                document.getElementById('envStability').className = 'status-warning';
            } else {
                document.getElementById('overallHealth').className = 'status-offline';
                document.getElementById('overallBar').className = 'metric-fill metric-offline';
                document.getElementById('cropSurvival').textContent = '8%';
                document.getElementById('cropSurvival').className = 'status-offline';
                document.getElementById('envStability').textContent = 'CRITICAL';
                document.getElementById('envStability').className = 'status-offline';
            }
        }

        function clearAdminLog() {
            const log = document.getElementById('adminLog');
            log.innerHTML = '<div class="text-slate-500">$ Administrative log cleared...</div>';
        }

        function logAdmin(message, type = 'info') {
            const log = document.getElementById('adminLog');
            const timestamp = new Date().toLocaleTimeString('en-US', { hour12: false });
            
            let className = 'text-slate-300';
            switch(type) {
                case 'success':
                    className = 'text-emerald-400';
                    break;
                case 'error':
                    className = 'text-red-400';
                    break;
                case 'warning':
                    className = 'text-yellow-400';
                    break;
                case 'info':
                    className = 'text-blue-400';
                    break;
            }
            
            const logEntry = document.createElement('div');
            logEntry.className = `${className} mb-1`;
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            
            // Remove cursor if it exists
            const cursor = log.querySelector('.text-slate-500:last-child');
            if (cursor && cursor.textContent.includes('$')) {
                cursor.remove();
            }
            
            log.appendChild(logEntry);
            
            // Add new cursor
            const newCursor = document.createElement('div');
            newCursor.className = 'text-slate-500';
            newCursor.innerHTML = '$ _';
            log.appendChild(newCursor);
            
            log.scrollTop = log.scrollHeight;
        }

    </script>
</body>
</html>